# Database Migrations

Alembic migrations for GoalMap AI (async PostgreSQL with asyncpg).

## Commands

```bash
# Apply all migrations
uv run alembic upgrade head

# Create new migration (auto-detect model changes)
uv run alembic revision --autogenerate -m "add_new_field"

# Rollback last migration
uv run alembic downgrade -1

# Rollback all
uv run alembic downgrade base

# Show current revision
uv run alembic current

# Show migration history
uv run alembic history
```

## Migration History

| Revision | Description |
|----------|-------------|
| `35cca1248f0a` | Initial schema with node enum |
| `9d8e7f6a5b4c` | Add status enums |
| `a1b2c3d4e5f6` | Add progress to nodes |
| `26b82ef8f376` | Add context fields to blueprint |
| `f3d8acd0bc5c` | Add uncertainties to blueprint |
| `36b7d591f7e4` | Enforce 1:1 relationship (blueprint-roadmap) |
| `b1c2d3e4f5a6` | Rename end_point→goal, motivations→why |

## Tips

- Always run `uv run alembic upgrade head` after pulling new changes
- Review autogenerated migrations before applying (check `versions/` folder)
- Test migrations on local DB before production
